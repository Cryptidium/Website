<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Cryptidium</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="https://raw.githubusercontent.com/Cryptidium/Website/refs/heads/main/Assets/favicon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet" />

    <style>
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: 'Nunito', system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background-color: #200033;
        background: url("https://cryptidium.vercel.app/Assets/background.png") center/cover no-repeat fixed;
        color: #fff;
      }
      .nav {
        position: sticky;
        top: 0;
        z-index: 1000;
        display: flex;
        align-items: center;
        height: 80px;
        padding: 0 1.25rem;
        background: rgba(17,17,17,0.6);
        backdrop-filter: blur(8px);
        gap: 0.75rem;
      }
      .nav__logo { height: 52px; }
      main {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 80px);
        text-align: center;
        gap: 1rem;
      }
      h1 { font-size: 3em; margin: 0; }
      h3 { font-size: 1.5em; margin: 0 0 1.5rem; }
      .hero__logo { width: 200px; max-width: 90vw; height: auto; margin-bottom: 1rem; }
      .button-row {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .button-column {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .button {
        display: inline-block;
        padding: 0.75rem 1.75rem;
        background: #9200f3;
        color: #fff;
        text-decoration: none;
        font-size: 1rem;
        transition: background 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      }
      .button:hover {
        background: #440092;
        box-shadow: 0 6px 14px rgba(0,0,0,0.5);
      }
      select.button {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border: none;
        background: #9200f3;
        color: #fff;
        text-decoration: none;
        font-size: 1rem;
        padding: 0.75rem 1.75rem;
        transition: background 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        cursor: pointer;
      }
      select.button:hover {
        background: #440092;
        box-shadow: 0 6px 14px rgba(0,0,0,0.5);
      }
      select#downloadType.button {
        min-height: 46px;
        font-family: inherit;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background: #9200f3 url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M4.646 6.146a.5.5 0 0 1 .708 0L8 8.793l2.646-2.647a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E") no-repeat right 10px center;
        background-size: 1.5em;
        padding-left: 1rem;
      }
      .version {
        margin-top: 0.25rem;
        font-size: 0.875rem;
        color: #fff;
        opacity: 0.8;
        text-align: center;
      }
      .download-source {
        margin-top: 2rem;
      }
      .download-source .button {
        min-width: 255.5px;
      }
    </style>
  </head>
  <body>
    <header class="nav">
      <img class="nav__logo" src="https://cryptidium.vercel.app/Assets/logo.png" alt="Cryptidium logo" />
      <h2>Cryptidium</h2>
    </header>

    <main>
      <img class="hero__logo" src="https://cryptidium.vercel.app/Assets/logo.png" alt="Cryptidium large logo" />
      <h1>Designed to be fast</h1>
      <h3>A modern open source WebKit web browser for Windows 11</h3>

      <div class="button-row">
        <div>
          <a id="download1" class="button" href="#" download>Download Stable</a>
          <div id="version1" class="version">Loading…</div>
        </div>
        <div>
          <a id="download2" class="button" href="#" download>Download Beta</a>
          <div id="version2" class="version">Loading…</div>
        </div>
        <div>
          <select id="downloadType" class="button">
            <option value="installer">Standalone</option>
            <option value="standalone">Portable</option>
          </select>
        </div>
      </div>

      <div class="download-source">
        <div class="button-row">
          <div class="button-column">
            <a id="downloadSource" class="button" href="#" download>Download Browser Source</a>
            <div id="versionSource" class="version">Loading…</div>
          </div>
          <div class="button-column">
            <a id="downloadPrebuilt" class="button" href="#" download>Download Prebuilt WebKit</a>
            <div id="versionPrebuilt" class="version">Loading…</div>
          </div>
        </div>
      </div>
    </main>

    <script>
      const assetsBase = "https://cryptidium.vercel.app/UpdateUtility/";
      const versionUrl1 = assetsBase + "lateststableformatted";
      const versionUrl2 = assetsBase + "latestbetaformatted";
      const downloadUrl1 = assetsBase + "Installer/CryptidiumStable.exe";
      const downloadUrl2 = assetsBase + "Installer/CryptidiumBeta.exe";
      const downloadUrl3 = assetsBase + "Standalone/CryptidiumStable.zip";
      const downloadUrl4 = assetsBase + "Standalone/CryptidiumBeta.zip";

      const repoOwner = "Cryptidium";
      const repoName = "Cryptidium-Browser";
      const branch = "main";
      const sourceZipUrl = `https://github.com/${repoOwner}/${repoName}/archive/refs/heads/${branch}.zip`;

      const prebuiltRepoOwner = "Cryptidium";
      const prebuiltRepoName = "WebKit";
      const prebuiltBranch = "main";
      const prebuiltSourceUrl = `https://github.com/${prebuiltRepoOwner}/${prebuiltRepoName}/archive/refs/heads/${prebuiltBranch}.zip`;
      const prebuiltReadmeUrl = `https://raw.githubusercontent.com/${prebuiltRepoOwner}/${prebuiltRepoName}/${prebuiltBranch}/README.md`;

      function updateDownloadLinks() {
        const type = document.getElementById("downloadType").value;
        if (type === "installer") {
          document.getElementById("download1").href = downloadUrl1;
          document.getElementById("download2").href = downloadUrl2;
        } else {
          document.getElementById("download1").href = downloadUrl3;
          document.getElementById("download2").href = downloadUrl4;
        }
      }
      document.getElementById("downloadType").addEventListener("change", updateDownloadLinks);
      updateDownloadLinks();

      async function fetchText(url, id) {
        try {
          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error();
          const text = await res.text();
          document.getElementById(id).textContent = text.trim();
        } catch {
          document.getElementById(id).textContent = "Version unavailable";
        }
      }
      fetchText(versionUrl1, "version1");
      fetchText(versionUrl2, "version2");

      async function fetchLatestCommit(owner, repo) {
        try {
          const apiUrl = `https://api.github.com/repos/${owner}/${repo}/commits?per_page=1`;
          const res = await fetch(apiUrl, { headers: { "Accept": "application/vnd.github.v3+json" } });
          if (!res.ok) throw new Error();
          const data = await res.json();
          const sha = (data[0]?.sha || "").substring(0, 7);
          return sha ? `commit ${sha}` : "Unknown commit";
        } catch {
          return "Commit unavailable";
        }
      }
      document.getElementById("downloadSource").href = sourceZipUrl;
      fetchLatestCommit(repoOwner, repoName).then(label => {
        document.getElementById("versionSource").textContent = label;
      });

      async function fetchPrebuiltVersion() {
        try {
          const res = await fetch(prebuiltReadmeUrl, { cache: "no-store" });
          if (!res.ok) throw new Error();
          const text = await res.text();
          const lines = text.split("\n");
          const versionLine = lines[3] ? lines[3].trim() : "Version unavailable";
          document.getElementById("versionPrebuilt").textContent = versionLine;
        } catch {
          document.getElementById("versionPrebuilt").textContent = "Version unavailable";
        }
      }
      document.getElementById("downloadPrebuilt").href = prebuiltSourceUrl;
      fetchPrebuiltVersion();
    </script>
  </body>
</html>
